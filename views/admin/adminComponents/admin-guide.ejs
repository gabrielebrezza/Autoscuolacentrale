<!-- admin-guides.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/styles/adminguides.css">
    <!-- icone -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <title><%= title %></title>
</head>
<body>
    <%- include('header.ejs') %>


        <% for (let i = 0; i < guides.length; i++) { %>
            <% const guide = guides[i]; %>
            <h2><%= guide.instructor %></h2>
            <table>
                <thead>
                    <tr>
                        <th>Giorno</th>
                        <th>Ora</th>
                        <th>Prenotata</th>
                        <% if(guide.instructor == istruttore){ %>
                            <th>azioni</th>
                        <% } %>
                    </tr>
                </thead>
                <tbody>
                    <% for (let j = 0; j < guide.book.length; j++) { %>
                        <% const day = guide.book[j]; %>
                        <% for (let k = 0; k < day.schedule.length; k++) { %>
                            <% const schedule = day.schedule[k]; %>
                            <tr>
                                <td><%= day.day %></td>
                                <td><%= schedule.hour %></td>
                                <td>
                                    <% if(guide.instructor == istruttore){ %>
                                        <% if(schedule.student){ %>
                                            <span class="si"> <%= schedule.student %> </span>
                                        <% } else { %>
                                            <span class="no">NO</span>
                                        <% } %>
                                    <% } else { %>
                                        <% if(schedule.student){ %>
                                            <span class="si">SI</span>
                                        <% } else { %>
                                            <span class="no">NO</span>
                                        <% } %>
                                    <% } %>
                                </td>
                                    <% if(guide.instructor == istruttore){ %>
                                        <td>
                                            <% if (!schedule.student) { %>
                                                <span class="material-symbols-outlined deleteGuide" data-instructor="<%=istruttore%>" data-time="<%= day.day %> - <%= schedule.hour %>">delete</span>
                                            <% } else{ %>
                                                <% for( let n = 0; n < infos.length; n++ ) { %>
                                                    <% if(infos[n].userName == schedule.student){ %>
                                                        <span class="material-symbols-outlined userInfo" data-student="<%= infos[n].userName %>" data-email="<%= infos[n].email %>" data-cell="<%= infos[n].cell %>">info</span>
                                                    <% } %>
                                                <% } %>
                                            <% } %>
                                        </td>
                                    <% } %>
                            </tr>
                        <% } %>
                    <% } %>
                </tbody>
            </table>
        <% } %>

        <div id="infosContainer" style="display: none;">
            <h2>info allievo</h2>
            <div class="field">
                <h3>Email:</h3>
                <p id="inputEmail"></p>
            </div>
            <div class="field">
                <h3>Cell:</h3>
                <p id="inputCell"></p>
            </div>
        </div>
            
        <script>
            const deleteBtn = document.querySelectorAll('.deleteGuide');
            deleteBtn.forEach((btn) => {
                btn.addEventListener('click', () =>{
                    const deleteInstructor = btn.dataset.instructor;
                    const deleteTime = btn.dataset.time;
                fetch('/adminRemovebooking', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ instructor: deleteInstructor, time: deleteTime})
                })
                .then(response => {
                    if (response.ok) {
                        alert('Lezione di guida rimossa con successo');
                    } else {
                        alert('Errore durante la rimozione della lezione di guida');
                    }
                    window.location.reload();
                })
                .catch(error => {
                    console.error('Errore durante la rimozione della lezione di guida:', error);
                });
            });
            });


            const userInfo = document.querySelectorAll('.userInfo');
            const infosContainer = document.getElementById('infosContainer');
            const inputEmail = document.getElementById('inputEmail');
            const inputCell = document.getElementById('inputCell');
            userInfo.forEach((btn) =>{
                btn.addEventListener('click', () =>{
                    const email = btn.dataset.email;
                    const cell = btn.dataset.cell;
                    inputEmail.innerText = email;
                    inputCell.innerText = cell;
                    infosContainer.style.display = 'flex';
                });
            });
        </script>

</body>
</html>
